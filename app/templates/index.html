<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vision-Serveless - Painel de Controle</title>
    <style>body{font-family:sans-serif;margin:2em;background-color:#f4f4f9} .container{max-width:900px;margin:auto;background:white;padding:2em;border-radius:8px} h1,h2{color:#333;border-bottom:2px solid #007bff;padding-bottom:10px} .grid-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;} .form-section,.status-section{border:1px solid #ddd;padding:1.5em;border-radius:5px} label,input,select,button{display:block;width:95%;margin-bottom:1em;padding:10px;border-radius:4px;border:1px solid #ccc} button{background-color:#007bff;color:white;border:none;cursor:pointer;font-size:16px} button:hover{background-color:#0056b3} #logs, #results{background-color:#282c34;color:#abb2bf;padding:1em;height:200px;overflow-y:scroll;white-space:pre-wrap;font-family:monospace} #stats-table{width:100%;border-collapse:collapse;} #stats-table th, #stats-table td{border:1px solid #ddd;padding:8px;text-align:left;}</style>
</head>
<body>
<div class="container">
    <h1>Painel de Controle Vision-Serveless (LocalStack)</h1>
    <div id="results">Aguardando requisição...</div>

    <div class="grid-container">
        <div class="form-section">
            <h2>Processamento de Imagem</h2>
            <form class="upload-form">
                <input type="hidden" name="operation" value="img_to_bw">
                <label>Converter para Preto e Branco</label>
                <input type="file" name="file" required>
                <button type="submit">Executar</button>
            </form>
            <hr>
            <form class="upload-form">
                 <input type="hidden" name="operation" value="img_change_format">
                 <label>Converter Formato de Imagem</label>
                 <input type="file" name="file" required>
                 <select name="params" required><option value="jpeg">Para JPEG</option><option value="png">Para PNG</option></select>
                 <button type="submit">Executar</button>
            </form>
        </div>
        <div class="form-section">
            <h2>Processamento de Vídeo</h2>
            <form class="upload-form">
                <input type="hidden" name="operation" value="extract_frame">
                <label>Extrair Frame de Vídeo</label>
                <input type="file" name="file" required>
                <input type="number" name="params" placeholder="Segundo para extrair (ex: 5)" required>
                <button type="submit">Executar</button>
            </form>
        </div>
    </div>
    
    <div class="grid-container">
        <div class="status-section">
            <h2>Estatísticas de Uso</h2>
            <table id="stats-table">
                <thead><tr><th>Operação</th><th>Execuções</th></tr></thead>
                <tbody id="stats-body"><tr><td colspan="2">Carregando...</td></tr></tbody>
            </table>
        </div>
        <div class="status-section">
            <h2>Logs da Aplicação</h2>
            <div id="logs">Carregando logs...</div>
        </div>
    </div>
</div>

<script>
document.querySelectorAll('.upload-form').forEach(form => {
    form.addEventListener('submit', async function(e) { /* ... (mesmo JS da versão anterior) ... */ });
});

async function updateAll() {
    // Busca logs
    try {
        const logsDiv = document.getElementById('logs');
        const r1 = await fetch('/logs');
        const text = await r1.text();
        if (logsDiv.textContent !== text) {
            logsDiv.textContent = text;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
    } catch (e) { /* fail silently */ }
    
    // Busca estatísticas
    try {
        const statsBody = document.getElementById('stats-body');
        const r2 = await fetch('/stats');
        const data = await r2.json();
        let html = '';
        if (Object.keys(data).length === 0) {
            html = '<tr><td colspan="2">Nenhuma operação executada ainda.</td></tr>';
        } else {
            for (const [op, count] of Object.entries(data)) {
                html += `<tr><td>${op}</td><td>${count}</td></tr>`;
            }
        }
        statsBody.innerHTML = html;
    } catch (e) { /* fail silently */ }
}

// Atualiza tudo a cada 5 segundos
setInterval(updateAll, 5000);
// Carga inicial
document.addEventListener('DOMContentLoaded', updateAll);
</script>
</body>
</html>